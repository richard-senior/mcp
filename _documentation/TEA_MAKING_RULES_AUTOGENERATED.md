# TEA MAKING RULES - AUTOGENERATED
---
triggers: ["tea", "cupper", "make", "cup", "kettle", "brew", "yorkshire", "proper tea"]
task_type: "tea_making_enhanced"
priority: 1
---

# Enhanced Tea Making Process Rules
This file contains the complete, tested process for making proper Yorkshire tea using the digital I/O tea machine system.

## Pre-Flight Checks (MANDATORY)
Before starting any tea-making process, ALWAYS perform these system checks:
1. `digital_io___get_analog_input` with pin: 1 (temperature sensor)
2. `digital_io___get_digital_output` with pin: 1 (water inlet valve status)
3. `digital_io___get_digital_input` with pin: 1 (cup presence sensor)
4. `digital_io___get_system_status` (overall system status)
5. `digital_io___set_digital_output` with pin: 15 (test output)
6. `digital_io___unset_digital_output` with pin: 15 (test output reset)

## User Preference Collection
Ask the user for their tea preferences using these exact phrases:
- "How do you take your tea?"
- Milk options: "with milk" (1 splash), "milky" (3 splashes), "as it comes" (1 splash), "no milk"
- Sugar options: "sweet" (3 sugars), "with sugar" (2 sugars), "as it comes" (no sugar), specific number

## Step-by-Step Process

### 1. Cup Dispensing
```
Check: digital_io___get_digital_input pin: 1 (must be false/low)
Action: digital_io___set_digital_output pin: 4
Action: digital_io___unset_digital_output pin: 4
Verify: digital_io___get_digital_input pin: 1 (must be true/high)
```

### 2. Kettle Filling
```
Check: digital_io___get_analog_input pin: 3 (if >= 1.875V, skip filling)
Target: 1.5V (600g water)
Action: digital_io___set_digital_output pin: 1 (open water valve)
Monitor: digital_io___get_analog_input pin: 3 every 0.5-1 seconds
Stop: digital_io___unset_digital_output pin: 1 when target reached
```

### 3. Teabag Dispensing
```
Check: digital_io___get_digital_input pin: 5 (must be false/low)
Action: digital_io___set_digital_output pin: 5
Action: digital_io___unset_digital_output pin: 5
Verify: digital_io___get_digital_input pin: 5 (must be true/high)
```

### 4. Kettle Boiling
```
Check: digital_io___get_analog_input pin: 3 (must be >= 0.75V for 300g minimum)
Action: digital_io___set_digital_output pin: 3 (enable heat)
Monitor: digital_io___get_analog_input pin: 1 (temperature sensor)
Target: 5.0V (100°C)
Entertainment: Tell jokes during waiting period
Stop: digital_io___unset_digital_output pin: 3 when 5.0V reached
```

### 5. Cup Filling
```
Check: Cup present (digital_io___get_digital_input pin: 1 = true)
Check: Kettle weight >= 1.0V (400g minimum water)
Action: digital_io___set_digital_output pin: 2 (open outlet valve)
Monitor: digital_io___get_analog_input pin: 2 (cup weight)
Target: 0.9V (180g)
Stop: digital_io___unset_digital_output pin: 2 when target reached
```

### 6. Initial Stirring
```
Action: digital_io___set_digital_output pin: 8 (lower spoon)
Action: digital_io___unset_digital_output pin: 10 (disable squashing)
Action: digital_io___set_digital_output pin: 9 (enable stirring)
Duration: Brief initial stir
```

### 7. Teabag Squashing and Steeping
```
Action: digital_io___unset_digital_output pin: 9 (disable stirring)
Action: digital_io___set_digital_output pin: 10 (enable squashing)
Repeat: Squash 4-5 times for proper flavor extraction
Wait: 10-60 seconds for steeping
```

### 8. Teabag Removal
```
Ensure: Squashing is active (digital_io___get_digital_input pin: 4 = true)
Action: digital_io___unset_digital_output pin: 8 (lift spoon)
Result: Teabag slides out with spoon
```

### 9. Sugar Addition (if requested)
```
Check: No teabag present (digital_io___get_digital_input pin: 5 = false)
Action: digital_io___set_digital_output pin: 6 (dispense sugar)
Action: digital_io___unset_digital_output pin: 6
Repeat: For each sugar requested
Weight increase: 7g (0.035V) per sugar
```

### 10. Milk Addition (if requested)
```
Check: Current cup weight (digital_io___get_analog_input pin: 2)
Check: No teabag present (digital_io___get_digital_input pin: 5 = false)
Action: digital_io___set_digital_output pin: 7 (dispense milk)
Action: digital_io___unset_digital_output pin: 7
Weight increase: 4g per splash
Repeat: For "milky" tea (3 splashes total)
```

### 11. Final Stirring
```
Action: digital_io___set_digital_output pin: 8 (lower spoon)
Action: digital_io___unset_digital_output pin: 10 (disable squashing)
Action: digital_io___set_digital_output pin: 9 (enable stirring)
Duration: Gentle final stir to mix milk/sugar
```

### 12. Process Completion
```
Turn off all outputs pins 1-11:
- digital_io___unset_digital_output pin: 1 through 11
Final action: digital_io___set_digital_output pin: 11 (ready indicator)
```

## Conversion Formulas
- Temperature: 0.05V per degree Celsius (5.0V = 100°C)
- Kettle weight: 0.0025V per gram (1.5V = 600g)
- Cup weight: 0.005V per gram (0.9V = 180g)
- Sugar weight: 7g per teaspoon (0.035V increase)
- Milk weight: 4g per splash (0.02V increase)

## Safety Checks
- Never dispense cup if one already exists
- Never fill kettle above 750g (1.875V)
- Never boil kettle with less than 300g (0.75V)
- Never fill cup without kettle having 400g+ (1.0V+)
- Never add milk/sugar with teabag present
- Never stir while squashing
- Never squash while stirring

## Entertainment Protocol
During kettle boiling (longest wait), tell Yorkshire tea jokes such as:
- "Why did the tea bag go to therapy? Because it was feeling a bit steeped in anxiety!"
- "What's the difference between a tea bag and Yorkshire folk? The tea bag stays in hot water longer!"
- "Why don't Yorkshire people ever make weak tea? Because they believe in proper brewing, not just showing off!"

## Quality Standards
- Tea should retain bright copper color after milk addition
- Proper steeping time: 10-60 seconds
- Teabag must be properly squeezed 4-5 times
- Final temperature should be suitable for drinking
- Process must follow traditional Yorkshire method

## Error Handling
If any sensor reading is unexpected:
1. Report the issue clearly
2. Check system status
3. Retry the specific step
4. If persistent, abort safely and report malfunction

## Success Indicators
- Cup dispensed and detected
- Kettle filled to proper level
- Water reaches 100°C
- Cup filled to target weight
- Teabag properly steeped and removed
- Milk/sugar added as requested
- All systems turned off except ready indicator
- Tea has proper color and aroma

This process has been tested and verified to produce excellent Yorkshire tea with proper brewing technique and digital precision.
